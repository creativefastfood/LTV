"""
Fotofactor Client Analytics Dashboard

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã:
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (LTV, —Å–µ–≥–º–µ–Ω—Ç—ã, —Ç–∏–ø—ã —Å—ä—ë–º–æ–∫)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –í–∏–¥–∂–µ—Ç—ã —Å —Ç–æ–ø-–∫–ª–∏–µ–Ω—Ç–∞–º–∏, —Ç—Ä–µ–Ω–¥–∞–º–∏, –∞–ª–µ—Ä—Ç–∞–º–∏
"""
import streamlit as st
from pathlib import Path
import sys

# –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ PYTHONPATH
ROOT_DIR = Path(__file__).parent.parent
sys.path.insert(0, str(ROOT_DIR))

st.set_page_config(
    page_title="Fotofactor Analytics",
    page_icon="üìä",
    layout="wide",
    initial_sidebar_state="expanded"
)

# –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
st.title("üìä Fotofactor Client Analytics Dashboard")

st.markdown("""
### –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –¥–∞—à–±–æ—Ä–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤!

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å–ª–µ–≤–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏:

- **üìà –û–±–∑–æ—Ä** - –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ KPI
- **üë• –ö–ª–∏–µ–Ω—Ç—ã** - –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- **üéØ –°–µ–≥–º–µ–Ω—Ç—ã** - –ê–Ω–∞–ª–∏–∑ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ A/B/C/U
- **üì∏ –¢–∏–ø—ã —Å—ä—ë–º–æ–∫** - –ê–Ω–∞–ª–∏–∑ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —É—Å–ª—É–≥
- **üìâ –¢—Ä–µ–Ω–¥—ã** - –î–∏–Ω–∞–º–∏–∫–∞ LTV –∏ –∑–∞–∫–∞–∑–æ–≤

---

### –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
""")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
from utils.data_loader import load_companies_summary

try:
    summary = load_companies_summary()

    col1, col2, col3, col4 = st.columns(4)

    with col1:
        st.metric(
            label="–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤",
            value=f"{summary['total_companies']:,}",
            delta=f"{summary['companies_with_orders']:,} —Å –∑–∞–∫–∞–∑–∞–º–∏"
        )

    with col2:
        st.metric(
            label="Total LTV",
            value=f"{summary['total_ltv']:,.0f} ‚ÇΩ",
            delta=f"{summary['avg_ltv']:,.0f} ‚ÇΩ —Å—Ä–µ–¥–Ω–∏–π"
        )

    with col3:
        st.metric(
            label="–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤",
            value=f"{summary['total_orders']:,}",
            delta=f"{summary['avg_orders_per_company']:.1f} –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞"
        )

    with col4:
        st.metric(
            label="–¢–∏–ø —Å—ä—ë–º–∫–∏",
            value=f"{summary['companies_with_shooting_type']:,}",
            delta=f"{summary['shooting_type_percent']:.1f}% –∑–∞–ø–æ–ª–Ω–µ–Ω–æ"
        )

    st.success("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö")

except Exception as e:
    st.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
    st.info("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `platrum.db` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.")

st.markdown("""
---

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. **–§–∏–ª—å—Ç—Ä—ã** –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –≥—Ä–∞—Ñ–∏–∫–∞–º
2. **–ö–ª–∏–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫** –¥–ª—è drill-down (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä)
3. **Hover** –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
4. **–≠–∫—Å–ø–æ—Ä—Ç** –¥–∞–Ω–Ω—ã—Ö –≤ Excel –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

üí° **–°–æ–≤–µ—Ç**: –ù–∞—á–Ω–∏—Ç–µ —Å —Ä–∞–∑–¥–µ–ª–∞ "–û–±–∑–æ—Ä" –¥–ª—è –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω—ã, –∑–∞—Ç–µ–º —É–≥–ª—É–±–ª—è–π—Ç–µ—Å—å –≤ –¥–µ—Ç–∞–ª–∏.
""")
